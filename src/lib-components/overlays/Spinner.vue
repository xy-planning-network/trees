<template>
  <div
    class="fixed top-0 left-0 flex items-center justify-center w-full h-full cursor-not-allowed z-50 bg-gray-50 bg-opacity-50"
    v-if="loading"
  >
    <div>
      <div class="flex justify-center">
        <div class="animate-spin-gear">
          <svg
            width="129px"
            height="129px"
            viewBox="0 0 129 129"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <title>Group 6 Copy 3</title>
            <defs>
              <polygon
                id="path-1"
                points="0.000248076923 0.48676924 128.472837 0.48676924 128.472837 128.800648 0.000248076923 128.800648"
              ></polygon>
            </defs>
            <g
              id="Page-1"
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
            >
              <g id="Group-6-Copy-3">
                <g id="Group-3">
                  <mask id="mask-2" fill="white">
                    <use xlink:href="#path-1"></use>
                  </mask>
                  <g id="Clip-2"></g>
                  <path
                    d="M86.3955173,100.279324 C86.3955173,100.279324 79.4778923,106.213874 64.2360462,106.755809 C48.9954404,106.213874 42.0778154,100.279324 42.0778154,100.279324 C11.8756904,81.4963011 25.2309115,49.088357 25.2309115,49.088357 C36.5680269,24.1350542 59.1839596,22.5554236 63.8105942,22.4983139 L63.8105942,22.5043894 C63.8105942,22.5043894 63.9681231,22.4983139 64.2360462,22.4958837 C64.5052096,22.4983139 64.6627385,22.5043894 64.6627385,22.5043894 L64.6627385,22.4983139 C69.2881327,22.5554236 91.9053058,24.1350542 103.241181,49.088357 C103.241181,49.088357 116.596402,81.4963011 86.3955173,100.279324 L86.3955173,100.279324 Z M128.473085,68.8191581 L128.473085,60.4677727 L117.036738,58.80187 L115.10794,49.3726905 L124.970238,43.4186983 L121.675777,35.7307578 L110.49619,38.6214817 L106.161046,32.1486416 L113.220075,23.080347 L107.361738,17.0716753 L97.9645846,23.7437918 L89.14545,17.842049 L91.8693346,6.72144964 L84.04995,3.59378109 L78.2114596,13.4628269 L69.5907865,11.8127205 L67.908825,0.48676924 L64.6627385,0.48676924 L63.8105942,0.48676924 L60.5645077,0.48676924 L58.8813058,11.8127205 L50.2618731,13.4628269 L44.4233827,3.59378109 L36.6039981,6.72144964 L39.3278827,17.842049 L30.5087481,23.7437918 L21.1103538,17.0716753 L15.2520173,23.080347 L22.3122865,32.1486416 L17.9771423,38.6214817 L6.79755577,35.7307578 L3.50185385,43.4186983 L13.3641519,49.3726905 L11.4365942,58.80187 L0.000248076923,60.4677727 L0.000248076923,68.8191581 L11.4365942,70.4850608 L13.1036712,79.0223566 L3.13718077,84.8050196 L6.29644038,92.5488548 L17.5244019,89.8513318 L23.4832096,98.5854738 L16.7466808,107.893143 L22.8134019,113.695248 L31.9699212,106.70356 L38.5067481,110.99651 L35.5881231,122.068505 L43.35045,125.332265 L49.3625942,115.565287 L58.8813058,117.47421 L60.5645077,128.801377 L63.6927577,128.801377 L64.780575,128.801377 L67.908825,128.801377 L69.5907865,117.47421 L79.1107385,115.565287 L85.1228827,125.332265 L92.8852096,122.068505 L89.9665846,110.99651 L96.5034115,106.70356 L105.659931,113.695248 L111.725412,107.893143 L104.988883,98.5854738 L110.94769,89.8513318 L122.175652,92.5488548 L125.334912,84.8050196 L115.369662,79.0223566 L117.035498,70.4850608 L128.473085,68.8191581 Z"
                    id="Fill-1"
                    fill="#51A749"
                    mask="url(#mask-2)"
                  ></path>
                </g>
              </g>
            </g>
          </svg>
        </div>
        <div class="absolute">
          <svg
            class="mt-8"
            width="70px"
            height="70px"
            viewBox="0 0 53 32"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <title>Group 3 Copy</title>
            <g
              id="Page-1"
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
            >
              <g id="Group-3-Copy">
                <polygon
                  id="Fill-1"
                  fill="#1F6DF4"
                  points="0.7994 0.3999 11.2214 16.0009 0.7994 31.5999 11.2214 31.5999 16.4004 24.0149 21.1934 31.5999 31.9994 31.5999 21.4254 15.7449 26.0064 9.1719 20.6194 1.3729 16.1554 7.9149 11.2214 0.3999"
                ></polygon>
                <polygon
                  id="Fill-2"
                  fill="#51A749"
                  points="41.978 0.3999 36.799 7.6269 32.006 0.3999 21.2 0.3999 31.775 15.5069 27.194 21.7689 32.27 29.1999 52.4 0.3999"
                ></polygon>
              </g>
            </g>
          </svg>
        </div>
      </div>
      <div v-show="messages">
        <transition
          appear
          enter-active-class="ease-out duration-1000"
          enter-from-class="opacity-0"
          enter-to-class="opacity-100"
          leave-active-class="ease-in duration-500"
          leave-from-class="opacity-100"
          leave-to-class="opacity-0"
          @after-enter="fadeOut"
          @after-leave="fadeIn"
        >
          <div class="transition-opacity" v-show="showMsg">{{ msg }}</div>
        </transition>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { Vue } from "vue-property-decorator";

export default class Spinner extends Vue {
  idx = 0;
  loading = false;
  maxIdx = 0;
  messages = [];
  msg = "";
  showMsg = false;

  mounted() {
    window.VueBus.on("Spinner-show", (messages) => {
      if (messages) {
        this.messages = messages;
        this.maxIdx = this.messages.length - 1;
        this.msg = this.messages[this.idx];
        this.showMsg = true;
      }
      this.loading = true;
    });

    window.VueBus.on("Spinner-hide", () => {
      this.idx = 0;
      this.maxIdx = 0;
      this.messages = [];
      this.msg = "";
      this.loading = false;
    });
  }

  fadeIn(): void {
    this.idx++;
    if (this.idx > this.maxIdx) {
      this.idx = 0;
    }
    if (this.messages) {
      this.msg = this.messages[this.idx];
    }
    this.showMsg = true;
  }
  fadeOut(): void {
    window.setTimeout(() => {
      this.showMsg = false;
    }, 2500);
  }
}
</script>
